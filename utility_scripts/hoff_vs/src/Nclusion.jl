module Nclusion

using Pkg
Pkg.update()




#  ["PProf", "ForwardDiff", "DistributionsAD", "EvalMetrics", "Measurements", "MLDatasets", "OrderedCollections", "CategoricalArrays", "Clustering", "Permutations", "StatsFuns", "JLD2", "Zygote", "Expectations", "DataFrames", "SpecialFunctions", "Turing", "MCMCChains", "StatsModels", "MLJ", "Distributions", "JSON3", "AdvancedVI", "TimerOutputs", "MLJBase", "Combinatorics", "TSne", "KernelDensity", "HDF5", "Muon", "ProgressMeter", "Gadfly", "FileIO", "TypedTables", "TimeSeries", "Printf", "PrettyTables", "CSV", "Stan", "Revise", "Test", "Random", "Debugger", "BenchmarkTools", "Tulip", "Optim", "SortingAlgorithms", "StatsPlots", "ColorSchemes", "ReverseDiff", "PyCall", "DataFramesMeta", "JSON", "StatsBase", "Distances", "Flux", "Plots", "Profile", "NLSolversBase", "PyPlot", "StaticArrays", "XLSX", "RCall", "Chain", "GLM", "Hyperopt", "MLBase", "Lasso", "HypothesisTests", "JuMP", "OptimalTransport", "LaTeXStrings", "StochasticOptimalTransport", "ZygoteRules", "JuliaFormatter", "MultivariateStats", "RDatasets", "Colors", "NMF", "Gnuplot", "ClusterValidityIndices", "Hungarian"]
pkgList = ["PProf", "OrderedCollections",  "Clustering", "StatsFuns", "JLD2", "DataFrames", "SpecialFunctions", "Turing", "StatsModels",  "Distributions", "JSON3", "TSne",  "HDF5","ProgressMeter", "FileIO", "TypedTables", "PrettyTables", "CSV", "Test", "Random", "Debugger", "BenchmarkTools", "Optim", "StatsPlots", "ColorSchemes", "PyCall", "DataFramesMeta", "JSON", "StatsBase", "Distances", "Flux", "Plots", "Profile", "StaticArrays", "XLSX", "RCall", "Hyperopt", "MLBase", "HypothesisTests",  "LaTeXStrings", "JuliaFormatter", "MultivariateStats", "RDatasets", "Colors", "Gnuplot", "ClusterValidityIndices", "Hungarian"]
for pkg in pkgList
    if !(pkg in keys(Pkg.project().dependencies))
        Pkg.add(pkg)
    end  
end
Pkg.instantiate()
curr_dir = ENV["PWD"]
src_dir = "/src/"
env_location = curr_dir*"/nclsn/bin/python"
ENV["PYTHON"] = env_location
Pkg.build("PyCall")
Pkg.build("RCall")



using Random
using Distributions
using Flux, Turing
using Turing.Variational
using Turing.RandomMeasures: stickbreak, DirichletProcess, StickBreakingProcess, ChineseRestaurantProcess
using StatsBase, StatsFuns, StatsModels, StatsPlots, Statistics, LinearAlgebra, HypothesisTests,Distances
using Test
using Debugger
using CSV,DataFrames
using JSON, JSON3
using Dates
using TSne, MultivariateStats, Clustering
using LaTeXStrings, TypedTables, PrettyTables
using RCall
using Gnuplot, Colors, ColorSchemes
using SpecialFunctions
using Optim
using BenchmarkTools
using DataFramesMeta
using Profile
using JLD2,FileIO,HDF5
using Hyperopt
using OrderedCollections
using StaticArrays
using ClusterValidityIndices
using ProgressMeter
using PyCall
using Hungarian
using Distributed
using Base.Threads
using BlackBoxOptim

curr_dir = ENV["PWD"]
src_dir = "/src/"
include(curr_dir*src_dir*"PlottingUtils.jl")
using .PlottingUtils
export plotDataGeneratingDist, plotNBMMDataGeneratingDist,plotPMMDataGeneratingDist, plotDataGeneratingDistAndSave!, plotNBMMDataGeneratingDistAndSave!, plotPMMDataGeneratingDistAndSave!, plotDataScatterAtTime, makeDataScatterGIF, plotDataScatterAndSave!, plot_All_Time_Points_PCA, plot_All_Time_Points_TSNE, plotGGenesDataScatterAtTime, plotGGenesDataScatterAndSave!, make_heatmapPlotatT, plotGGenesHeatMapAndSave!, labelMaker, plotCorrectClusteringRates, plotlambdaposteriorSamples, plotNumClusters, plotlambdaposteriorChainAndDensity, plotNumClustersOverItr, makeAvgPosteriorClusterMembershipGIF, plotAvgPosteriorClusterMembershipAtTime, plotAvgPosteriorClusterMembershipAtTimeStacked, makePosteriorClusterAssignmentTable_fromSubClusterMax, PosteriorPlotsAndSave!,PosteriorNumClustersPlotsAndSave!, PosteriorlambdaSamplesPlotsAndSave!, PosteriorClusteringRatePlotsAndSave!, PosteriorlambdaChainPlotsAndSave!, PosteriorlambdaPosteriorValueHistogramPlotsAndSave!, PosteriorlambdaRunningMeanPlotsAndSave!, plotAvgPosteriorClusterMembershipAndSave!, plotAvgPosteriorClusterMembershipAndSave2!, PosteriorClusterAssignmentTable_fromSubClusterMaxAndSave!, PosteriorMixtureWeightsAndSave!, plotStackedAvgPosteriorClusterMembershipAndSave!, plotStackedAvgPosteriorClusterMembershipAndSave2!, plot_MixtureWeights_post, plotNMI, plotPosteriorClusteringNMIAndSave!, plotAdjustedRandIndx, plotNMI,plotPosteriorClusteringNMIAndSave!, plotAdjustedRandIndx, plotPosteriorClusteringARIAndSave!, plotVMeasure, plotPosteriorClusteringVMeasureAndSave!, plotVarInfo, plotPosteriorClusteringVarInfoAndSave!, plotTimingsSubplot, plotMetricsSubplot, gnu_stackedhistogram_plot, gnu_allcellshistogram_plot, gnuplotcluster_geneimportanceweights, gnu_stackedhistogram_plot, gnu_multiplot_1feature_type_binhistogram_plot, gnu_multiplot_1feature_type_binhistogram_withmeans_plot, gnu_1feature_all_binhistogam_plot, gnu_plot_1gene_data_hist, gnu_multiplot_1gene_data_hist, gnu_multiplot_stackedhistogram_plot, gnu_multiplot_stackedhistogram_plot2, gnu_multiplot_allcellshistogram_plot, gnu_plot_All_Time_Points_PCA, gnu_plot_All_Time_Points_TSNE, gnu_multiplot_plot_All_Time_Points_TSNE, gnu_multiplot_plot_All_Time_Points_PCA, gnu_multiplot_plot_All_Time_Points_PCA_circles, gnu_multiplot_plot_All_Time_Points_TSNE_circles, gnu_elbo_plot, gnu_tidy_multiplot_plot_All_Time_Points_PCA_ToyData_circles, gnu_multiplot_plot_All_Time_Points_PCA_4Plots_circles, gnu_multiplot_plot_All_Time_Points_TSNE_4Plots_circles, gnu_elbovsK_plot, gnu_ARIvsK_plot, gnu_tidy_multiplot_plot_All_Time_Points_TSNE_ToyData_circles, gnu_tidy_multiplot_plot_All_Time_Points_PCA_4Plots, gnu_tidy_multiplot_plot_All_Time_Points_TSNE_4Plots, gnu_multiplot_plot_inclusion_probabilities, gnu_plot_dotplot, gnu_plot_allocations_barchart, gnu_plot_memory_barchart, gnu_plot_avg_time_barchart, gnu_plot_median_time_barchart, gnu_plot_num_evals_barchart, gnu_plot_cumulative_avg_time, gnu_plot_cumulative_alloc, gnu_plot_cumulative_memory, gnu_plot_varying_allocations, gnu_plot_varying_memory, gnu_plot_varying_avg_time, gnu_plot_varying_median_time, gnu_plot_varying_num_evals, gnu_plot_inferred_signal_null_dist, gnu_multiplot_all_inferred_signal_null_dist, gnu_plot_bayesfactors, gnu_multiplot_grand_tour, gnu_ARIvsMaxIter_plot,  gnu_FinalElbovsMaxIter_plot, gnu_multiplot_elbo_vs_metrics_correlation, gnu_ParamVsMetric_scatterplot, gnu_multiplot_ParamVsMetric_scatterplot, gnu_plot_speedups, gnu_multiplot_metrics_speedups, gnu_multiplot_functions_speedups, get_tidy_tsne_transform, get_tsne_transform, get_tidy_PCA_transform, get_PCA_transform, get_conversion_units,reorder_colors

include(curr_dir*src_dir*"MathUtils.jl")
using .MathUtils

export  StickBreaking, jitter!, calc_r, calc_p, calc_dispersion, t_test,norm_weights,normToProb,maxk!,norm_weights3!, normToProb3!,log_norm_pdf3,vectorfloor!



include(curr_dir*src_dir*"MCMCInferenceUtils.jl")
using .MCMCInferenceUtils
export addNewTimepoint!,addClusterFromGammaBaseDist!,addToExistingPoisGammaCluster!,generate_V_h_init,generate_θ_t,generate_π_h_init,_2ndBlockedGibbs_AllTimeStep,_BlockedGibbs_AllTimeStepInit,_3rdBlockedGibbs_AllTimeStep,_4thBlockedGibbs_AllTimeStep,_1stBlockedGibbs_AllTimeStep,_1stBlockedGibbs_1stTimeStep,_firstAttempt,timeseries_indep_dp_pmm1,timeseries_indep_dp_pmm2,timeseries_indep_dp_pmm2FactorialDesign,timeseries_indep_dp_pmm3,timeseries_indep_dp_pmm_MixtureModelLiklihood1,timeseries_indep_dp_pmm_MultivariateMixtureModelLiklihood1,timeseries_indep_dp_pmm_MultivariateMixtureModelLiklihood2,timeseries_indep_dp_pmm_MultivariateMixtureModelLiklihood22,timeseries_hdp_pmm_MultivariateMixtureModelLiklihood1,timeseries_hdp_pmm_MultivariateMixtureModelLiklihood2,timeseries_hdp_pmm_MultivariateMixtureModelLiklihood3,timeseries_hdp_gmm_MultivariateMixtureModelLiklihood1,timeseries_indep_dp_gmm1,_indep_dp_gmm1,_indep_dp_pmm1,timeseries_indep_dp_pmm1_fixedλ,infiniteTimeSeriesPMM,dp_pmm_sb2,dp_pmm_sb1,timeseries_Hdpsb_dp_pmm1,timeseries_Hdpsb_dp_pmm2, timeseries_ddp_pmm, getEmpricalCorrectClusteringRates, getzIDs, getzDF, getlambdaIDs, getlambdaposteriorAvg, getlambdaposteriorDF,getmuposteriorAvg,getmuposteriorDF,getmuIDs,getsigmaposteriorAvg,getsigmaposteriorDF,getsigmaIDs,generateDataDF_from_TuringChain,get_var_ids,get_chain_var,get_static_chn_param_univariate,get_dynamic_chn_param_univariate,unpack_data_chn_param,get_πposterior,get_Poisson_cell_lhprob,get_Normal_cell_lhprob,get_P_tensor,stephens_relabelling,update_nu, init_nu,calculate_Q_hat,calculate_Cost_per_t,calculate_Cost_across_t,create_CostMat_across_t,get_average_posterior_cluster_frequency,get_chn_values_dict,relabel_chain_variable_dict,make_θ_t_var_names,make_π_t_var_names,make_v_var_names,make_z_var_names,make_λ_var_names,make_m_var_names,make_s_var_names,make_θ_t_vov2Mat,make_π_t_vov2Mat,make_v_vov2Mat,make_z_vov2Mat,make_λ_vov2Mat,make_m_vov2Mat,make_s_vov2Mat,make_vectorParam_vov2Mat,partition_matrix_cluster_df_names,partition_matrix_cluster_df_names2,_position1_Matrix_re_func,_position2_Matrix_re_func,_position2_Matrix_re_func2,π_t_post_vov2Mat,_get_πposterior,_get_HDP_πposterior,partition_cluster_df_names,get_cell_lhprob_mat,get_post_cluster_assgn,get_post_cluster_assgnMat2,get_post_cluster_assgnMat3,_get_chnMatrix_values_dict,_relabel_chain_variable_dict,make_PIP_t_var_names,make_z_t_vov2Mat,make_PIP_t_vov2Mat,make_λmat_vov2Mat,make_λmat_var_names,getLambdaInferenceModel2_newNames,extract,re_func, time_re_func,cellID_re_func, _position1_re_func,_position2_re_func,_position3_re_func,general_re_func,get_average_posterior_cluster_frequency2,get_clus_w_maxPopAtT,FindNonunique_func


include(curr_dir*src_dir*"DataGenUtils.jl")
using .DataGenerationUtils

export fake_mvGausssian_data_for_testing,fake_mvGausssian_data_largeG_indepG_for_testing,fake_mvGausssian_data_indepG_for_testing,fake_Poisson_data_for_testing,fake_generateGPhenNormal_RoundedCensored_indepG_for_testing,fake_mvGausssian_corrdata_for_testing,fake_mvCountsViaCopulas_corrdata_for_testing,generate_number_of_DEG,generate_DEG_locations,generate_DEG_values!,generate_nonDEG_values!,generate_DEG_means,generate_rand_covariance_matrix,generate1Phen_SimpleCase1,generateGMM,generateGPhen_SimpleCase1,generateGPhenNormal_SimpleCase1,check_if_truth_dict_valid,   gen1Phen_SimpleCase1_NB_TimeInvar,gen4gene_Corr_PGMvLN,gen1Phen_SimpleCase1_Normal_TimeInvar,NBMixtureModel,NormalMixtureModel,genGPhen_SimpleCase1_NB_TimeInvar,gen1Phen_SimpleCase1_Poisson_TimeInvar,gen1Phen_SimpleCase1_PoissonGamma_TimeInvar

include(curr_dir*src_dir*"DataPreprocessingUtils.jl")
using .DataPreprocessingUtils

export getCustomersAtTimepoint,getTrueClusterMembershipDict, genData_vec2dict,raghavan2021_lognormalization,raghavan2021_lognormalization_depracated,raghavan2021_centerAndScale,raghavan2021_filterCells,raghavan2021_filterCellsWithMetadata,raghavan2021_filterGenes,raghavan2021_AddLabels!,mode_shift,
basal_condition,classical_condition,hybrid_condition,get_cell_class_label,sum_gene_counts,subsample_on_label,get_tumor_stats_column_indices,append_first_col_indx!,get_tumor_stats,get_max_score,append_maxscore!,insertCellLabels!,extract_histbin_infomation,get_celltype_1feature_metadata,get_metadata_at_timepoint,get_timepoint_labels,get_biopsy_labels,R_lognorm_FeatSelect_Scale_noMetaDataGenenames,R_lognorm_FeatSelect_Scale,R_VariableFeatSelect,get_hv_genes,
generate_processed_raghavan2021_data,subsample_tuning_set,generate_subsample_data_processed_raghavan2021_data,generate_processed_nonmalignant_raghavan2021_data,generate_processed_malignant_pt_raghavan2021_data,generate_processed_simulated_copulacorrelatedcounts_data,generate_subsample_data_processed_simulated_data,generate_processed_simulated_copulacorrelatedcounts_data,generate_processed_1condition_anndata_data,generate_subsample_data_processed_1condition_anndata_data


include(curr_dir*src_dir*"MetricsUtils.jl")
using .MetricsUtils


export getRandIndices,getNMI,getVmeasure,getVarInfo,getJaccardSimilarity,getMetrics_and_Stats,time_invariant_ari,time_invariant_nmi,time_invariant_vmeasure,time_invariant_jaccard,time_invariant_varinfo,calc_time_invariant_ARI_summarization,calc_time_variant_ARI_summarization,calc_time_invariant_NMI_summarization,calc_time_variant_NMI_summarization,calc_time_invariant_Vmeasure_summarization,calc_time_variant_Vmeasure_summarization,calc_time_invariant_VarInfo_summarization,calc_time_variant_VarInfo_summarization,calc_time_invariant_Jaccard_summarization,calc_time_variant_Jaccard_summarization,calc_time_invariant_CVI_summarization,setup_metrics_list,tidy_getRandIndices,tidy_calc_time_invariant_ARI_summarization,tidy_calc_time_variant_ARI_summarization,tidy_getNMI,tidy_calc_time_invariant_NMI_summarization,tidy_calc_time_variant_NMI_summarization,tidy_getVmeasure,tidy_calc_time_invariant_Vmeasure_summarization,tidy_calc_time_variant_Vmeasure_summarization,tidy_getVarInfo,tidy_calculate_elapsed_iterations,tidy_calculate_approx_cluster_utilization,tidy_calculate_overall_cluster_occupancy_rate,tidy_calculate_per_time_approx_cluster_utilization,tidy_calculate_per_time_cluster_occupancy_rate


include(curr_dir*src_dir*"IOUtils.jl")
using .IOUtils
export @name, naming_vec,set_current_value,addToDict!,addToOrderedDict!,generate_modelStatisticsFromDataFrame,generate_LabelInfoFromMetaDataFrame,generate_modelInputsFromDataFrames,getExperimentVariablesString, get_unique_time_id,nested_dict_to_json,nested_dict_to_json3_with_name,append_to_json,generate_json_filename, generate_filenameBase, generate_filenameBase_closure, generate_dirname, json_to_dict,json3_to_dictstruct, makeRelabellingOutputDirectories,makeGenericOutputDirectories,makeTidyOutputDirectories,saveInitializationFile,create_summarization_file,create_benchmark_summarization_file,save_run


include(curr_dir*src_dir*"VariationalInferenceUtils.jl")
using .VariationalInferenceUtils


export  variational_inference, depracated_variational_inference_notusingXhat, variational_inference_HDP, variational_inference_dynamicHDP, tidy_variational_inference_dynamicHDP, tidy_variational_inference_dynamicHDP_SparseVS, tidy_variational_inference_dynamicHDP_VS1, tidy_variational_inference_dynamicHDP_VS2, variational_inference_dynamicHDP_vs25_fast3, variational_inference_dynamicHDP_vs25_fast3_mtall, variational_inference_dynamicHDP_vs25_fast3_mtbest,variational_inference_dynamicHDP_vs25_fast3_mtbest_sparserestart, local_updates_fast3!, local_updates_fast3_mtall!, local_updates_fast3_mtbest!,local_updates_fast3_mtbest_sparserestart!, global_cluster_updates_fast3!, global_cluster_updates_fast3_mtall!, global_cluster_updates_fast3_mtbest!, global_condition_updates_fast3!, global_condition_updates_fast3_mtall!, global_condition_updates_fast3_mtbest!, extract_cluster_paramter, extract_condition_paramter, extract_rtik_paramter, extract_and_add_parameters_to_outputs_dict!, calc_DataElbo, calc_Hz, calc_SurragateLowerBound_unconstrained, calc_SurragateLowerBound, calc_Hs, calc_wAllocationsLowerBound, calc_GammaElbo, calc_alphaElbo, calc_ImportanceElbo, calc_Hv, calc_DataElbo7, calc_DataElbo12, tidy_calc_Hz, tidy_calc_Hs, tidy_calc_Hxi, tidy_calc_SurragateLowerBound_unconstrained, tidy_calc_GammaElbo, tidy_calc_wAllocationsLowerBound, tidy_calc_alphaElbo, tidy_calc_DataElbo, tidy_calc_DataElbo_SparseVS, tidy_calc_DataElbo_VS1, tidy_calc_DataElbo_VS2, tidy_elbo_calc, tidy_elbo_calc_SparseVS, tidy_elbo_calc_VS1, tidy_elbo_calc_VS2, calc_DataElbo25_fast3, calc_Hz_fast3, calc_HpipSurragateLowerBound_unconstrained_fast3, calc_wAllocationsLowerBound_fast3, calc_alphaElbo_fast3, calc_HsGammaAlphaElbo_fast3, calculate_elbo, c_Ga, c_Beta, update_rtik, update_Ntk, update_θ_hat, update_Nk, update_N, update_xbar_k, update_sk, update_λ0k_hat, update_a0k_hat, update_mk_hat, update_b0k_hat, update_Tk, update_rho_omega_hat, update_x_hat_sq_k, update_x_hat_k, update_x_hat_error_vs_forloops, update_x_hatk_signal_vs_forloops, update_x_hat_sq_error_vs_forloops, update_x_hatk_sq_signal_vs_forloops,  update_a0k_hat_usingXhat, update_b0k_hat_usingXhat, update_mk_hat_usingXhat, update_c_ttprime, update_awt_hat, update_bwt_hat, update_αt, update_γ, update_Tαk, get_gene_PIP25_fast3, get_gene_PIP25_fast3!, get_gene_PIP25_fast3_mt!, accumulate_deviance_log_norm_pdf3!, _accumulate_deviance_log_norm_pdf3!, update_rtik_vs25_fast3!, update_rtik_vs25_fast3_mt!, update_Ntk_fast3!, update_Ntk_fast3_mt!, calculate_sparse_restart!,reset_Ntk_sparse_restart!, update_c_ttprime_fast3!, update_c_ttprime_fast3_mt!, update_θ_hat_fast3!, update_θ_hat_fast3_mt!, update_θ_hat_sum_fast3!, update_θ_hat_sum_fast3_mt!, update_Nkj25_fast3!, update_Nkj25_fast3_mt!, update_x_hat_k25_fast3!, update_x_hat_k25_fast3_mt!, update_x_hat_sq_k25_fast3!, update_x_hat_sq_k25_fast3_mt!, update_λ0k_hat_fast3!, update_λ0k_hat_fast3_mt!, update_a0k_hat_usingXhat25_fast3!, update_a0k_hat_usingXhat25_fast3_mt!, update_mk_hat_usingXhat_fast3!, update_mk_hat_usingXhat_fast3_mt!, update_b0k_hat_usingXhat_fast3!, update_b0k_hat_usingXhat_fast3_mt!, update_αt_fast3!, update_αt_fast3_mt!, update_abwt_hat_fast3!, update_abwt_hat_fast3_mt!, update_γ_fast3, update_γ_fast3_mt, update_Tαk_fast3, update_Tαk_fast3_mt, update_rho_omega_hat_fast3!, tidy_update_rtik, tidy_update_rtik_SparseVS, tidy_update_rtik_VS1, tidy_update_rtik_VS2, tidy_update_θ_hat, tidy_update_c_ttprime, tidy_update_Nk, tidy_update_Nkj, tidy_update_Nej, tidy_update_Ntk, tidy_update_x_hat_k, tidy_update_x_hat_e, tidy_update_x_hat_sq_k, tidy_update_x_hat_sq_e, tidy_update_λ0k_hat!, tidy_update_λ0_err_hat!, tidy_update_a0k_hat_usingXhat!, tidy_update_a0_err_hat_usingXhat!, tidy_update_mk_hat_usingXhat!, tidy_update_m_err_hat_usingXhat!, tidy_update_b0k_hat_usingXhat!, tidy_update_b0_err_hat_usingXhat!, tidy_update_ηtkj_SparseVS, tidy_update_ηtkj_VS, tidy_update_αt!, tidy_update_wtildet!, tidy_update_γ, tidy_update_Tαk, tidy_update_rho_omega_hat!, tidy_local_update, tidy_global_update, tidy_local_update_SparseVS, tidy_global_update_SparseVS, tidy_local_update_VS1, tidy_local_update_VS2, tidy_global_update_VS, βk_expected_value, uk_expected_value, logUk_expected_value, log1minusUk_expected_value, log_π_expected_value, log_τ_kj_expected_value, log_τ_k_expected_value, τ_μ_expected_value, αt_expected_value, γ_expected_value, log_γ_expected_value, log_αt_expected_value, log_w_ttprime_expected_value, log_tilde_wt_expected_value, log_minus_tilde_wt_expected_value, log_τ_kj_error_expected_value, log_τ_k_error_expected_value, τ_μ_error_expected_value, adjust_e_log_π_tk3!, log_π_expected_value_fast3!, expectation_βk, recursive_minus_e_uk_cumprod, expectation_log_normal_l_j3!, expectation_log_π_tk, expectation_log_tilde_wtt, expectation_log_minus_tilde_wtt, expectation_uk, expectation_αt, expectation_log_αt, expectation_logUk, expectation_log1minusUk, tidy_τ_μ_expected_value, tidy_log_τ_kj_expected_value, tidy_log_τj_err_expected_value,tidy_τ_μ_err_expected_value, tidy_log_π_expected_value, tidy_βk_expected_value, tidy_uk_expected_value, tidy_logUk_expected_value, tidy_log1minusUk_expected_value, tidy_γ_expected_value, tidy_log_γ_expected_value, tidy_αt_expected_value, tidy_log_αt_expected_value, tidy_log_tilde_wt_expected_value, tidy_log_minus_tilde_wt_expected_value, tidy_log_w_ttprime_expected_value, init_params_genes, init_params_states, init_θ_hat_tk, init_ηtkj_prior, init_mk_hat!, init_λ0k_hat_vec!, init_a0k_hat_vec!, init_b0k_hat_vec!, init_ρωk_hat_vec!, init_a_γ_hat_vec!, init_b_γ_hat_vec!, init_awt_hat_vec!, init_bwt_hat_vec!, init_a_αt_hat_vec!, init_b_αt_hat_vec!, init_c_ttprime_hat_vec!, init_θ_hat_vec!, init_η_tkj_vec!, init_η_kj_vec!, init_pip_kj_vec!, init_v_tikj_vec!, init_rtik_vec!, init_m_err_hat!, init_λ0_err_hat_vec!, init_a0_err_hat_vec!, init_b0_err_hat_vec!,initialize_VariationalInference_types!, tidy_init_e_τ_μ_tikj_mat, tidy_init_e_log_τ_kj_mat, tidy_init_e_log_π_mat, tidy_init_rtik_mat, tidy_init_e_log_τj_err_mat, tidy_init_e_τ_μ_tij_err_mat, SurragateLowerBound_util, SurragateLowerBound_unconstrained_util, g_constrained!, g_unconstrained!, genterate_Delta_mk, g_constrained_closure!, g_unconstrained_closure!, SurragateLowerBound_closure, SurragateLowerBound_unconstrained_closure, sample_z_post, sample_st_post, sample_π_post, vi_make_z_post_s, vi_make_st_post_s, vi_make_π_post_s, calc_π_post_mean, sample_normalgamma_μ_τ_post, calc_normalgamma_μ_τ_post_mean, sample_gamma_τ_post, calc_gamma_τ_post_mean, calc_gamma_τ_post_mean, Features, CellFeatures, NullDistributionFeatures, CellClusterLogLikelihoodFeatures, ClusterFeatures, ConditionFeatures, DataFeatures, ModelParameterFeatures, get_timeranges, _reset!, tidy_vi_make_z_post_s, tidy_vi_make_s_post_s, tidy_vi_make_π_post_s, tidy_calc_π_post_summarization, tidy_vi_make_normalgamma_μ_τ_post_s, tidy_calc_μ_τ_post_summarization, tidy_get_average_posterior_cluster_frequency, create_results_dict, get_function_name, run_variational_inference_dynamicHDP_benchmarks, run_variational_inference_dynamicHDP_vs12_benchmarks, run_variational_inference_dynamicHDP_vs18_benchmarks, run_variational_inference_dynamicHDP_vs25_benchmarks, run_variational_inference_dynamicHDP_vs25_fast_benchmarks, run_variational_inference_dynamicHDP_vs25_fast2_benchmarks, benchmark_init_mk_hat, benchmark_init_λ0k_hat_vec, benchmark_init_ρωk_hat_vec, benchmark_init_a_γ_hat_vec, benchmark_init_b_γ_hat_vec, benchmark_init_awt_hat_vec, benchmark_init_bwt_hat_vec, benchmark_init_a_αt_hat_vec, benchmark_init_b_αt_hat_vec, benchmark_init_c_ttprime_hat_vec, benchmark_init_θ_hat_vec, benchmark_init_rtik_vec, benchmark_init_v_tikj_vec, benchmark_init_m_err_hat, benchmark_init_λ0_err_hat_vec, benchmark_init_a0_err_hat_vec, benchmark_init_b0_err_hat_vec, benchmark_init_params_genes, benchmark_log_π_expected_value, benchmark_log_τ_k_expected_value, benchmark_τ_μ_expected_value, benchmark_log_τ_kj_expected_value, benchmark_log_τ_kj_error_expected_value, benchmark_τ_μ_error_expected_value12, benchmark_update_rtik, benchmark_update_rtik_vs12, benchmark_init_pip_kj_vec, benchmark_update_Ntk, benchmark_update_c_ttprime, benchmark_update_θ_hat, benchmark_update_Nk, benchmark_update_N, benchmark_errorNj12, benchmark_signalNkj, benchmark_update_x_hat_k, benchmark_update_x_hat_sq_k, benchmark_update_x_hat_error_vs_forloops, benchmark_update_x_hatk_signal_vs_forloops, benchmark_update_x_hat_sq_error_vs_forloops12, benchmark_update_x_hatk_sq_signal_vs_forloops, benchmark_update_λ0k_hat, benchmark_update_mk_hat_usingXhat, benchmark_update_a0k_hat_usingXhat, benchmark_update_b0k_hat_usingXhat, benchmark_update_a0_err_hat_usingXhat12, benchmark_update_λ0_err_hat, benchmark_update_m_err_hat_usingXhat, benchmark_update_b0_err_hat_usingXhat12, benchmark_update_λ0k_signal_hat, benchmark_update_a0k_signal_hat_usingXhat, benchmark_update_mk_signal_hat_usingXhat, benchmark_update_b0k_signal_hat_usingXhat, benchmark_update_αt, benchmark_update_awt_hat, benchmark_update_bwt_hat, benchmark_update_γ, benchmark_γ_expected_value, benchmark_update_Tαk, benchmark_update_rho_omega_hat, benchmark_update_v_tikj12, benchmark_update_rtik_vs18, benchmark_update_N_rpip18, benchmark_update_Nkj18, benchmark_update_a0k_hat_usingXhat18, benchmark_get_gene_PIP, benchmark_calc_DataElbo18, benchmark_calc_Hpip, benchmark_calc_DataElbo, benchmark_calc_DataElbo12, benchmark_calc_Hz, benchmark_calc_SurragateLowerBound_unconstrained, benchmark_calc_Hs, benchmark_calc_wAllocationsLowerBound, benchmark_calc_GammaElbo, benchmark_calc_alphaElbo, benchmark_calc_ImportanceElbo, benchmark_calc_Hv, benchmark_log_π_expected_value25, benchmark_log_τ_k_expected_value25, benchmark_τ_μ_expected_value25, benchmark_log_τ_kj_expected_value25, benchmark_update_rtik_vs25, benchmark_update_x_hat_k25, benchmark_update_x_hat_sq_k25, benchmark_update_N_rpip25, benchmark_update_Nkj25, benchmark_update_a0k_hat_usingXhat25, benchmark_get_gene_PIP25, benchmark_calc_DataElbo25, benchmark_log_π_expected_value25_fast, benchmark_log_τ_k_expected_value25_fast, benchmark_τ_μ_expected_value25_fast, benchmark_log_τ_kj_expected_value25_fast, benchmark_update_rtik_vs25_fast, benchmark_update_rtik_vs25_fast2, benchmark_update_x_hat_k25_fast, benchmark_update_x_hat_sq_k25_fast, benchmark_update_N_rpip25_fast, benchmark_update_Nkj25_fast, benchmark_update_a0k_hat_usingXhat25_fast, benchmark_get_gene_PIP25_fast, benchmark_get_gene_PIP25_fast2, benchmark_calc_DataElbo25_fast, generate_a0k_testing, generate_b0k_testing, generate_λ0k_testing, generate_mk_testing, generate_a0_err_testing, generate_b0_err_testing, generate_λ0_err_testing, generate_m_err_testing, generate_rhok_testing, generate_omegak_testing, generate_a_γ_testing, generate_b_γ_testing, generate_awt_testing, generate_bwt_testing, generate_a_αt_testing, generate_b_αt_testing, generate_c_ttprime_testing, generate_θ_hat_testing, generate_rtik_testing, generate_v_tikj_testing, generate_pip_kj_imp_weights_testing, generate_η_kj_prior_testing, generate_x_testing, generate_e_log_π_testing, generate_e_log_τ_testing, generate_e_log_τkj_testing, generate_e_log_τkj_err_testing, generate_e_τ_μ_testing, generate_e_τ_μ_tikj_testing, generate_e_τ_0j_err_testing, generate_e_τ_0_err_testing, generate_Ntk_testing, generate_N_signal_testing, generate_N_error_testing, generate_Nj_error_testing, generate_Nkj_signal_testing, generate_Nk_testing, generate_x_hat_k_testing, generate_x_hat_sq_k_testing, generate_x_hat_error_testing, generate_x_hatk_signal_testing, generate_x_hat_sq_error_testing, generate_x_hatk_sq_signal_testing, generate_e_γ_testing, generate_Tαk_testing, generate_hyperparamters_testing, generate_init_vec_testing, generate_hyperparamters_vs12_testing, generate_init_vec_vs12_testing, generate_hyperparamters_testing18, generate_hyperparamters_testing25, generate_init_vec_testing25, generate_init_vec_testing18, generate_Glog_testing, generate_logpi_testing,f0,f12,f14,f15,f16,f17,f18,f19,f20,f21,f22,f23,f24,f25,f25_fast3series,f25_fast3seriesCH,f25_fast3seriesCH_kfolds,select_and_run_optimization_procedure,setup_avail_models,setup_avail_opt_functions,setup_avail_model_names,setup_avail_opt_functions_names,setup_model_indexing,setup_dataset_dict,setup_experiment_tag, print_helloWorld


include(curr_dir*src_dir*"GeneUtils.jl")
using .GeneUtils

export  create_vec_cluster_scores_mat, create_vec_cluster_gene_weights_mat, topGenesClusters_byCalledCluster, topGenesClusters_byAllCells,cells_in_k_clus_index,cells_not_in_k_clus_index,gene_weights_clus,gene_weights_not_clus,gene_weights_all,get_geneID,generate_topNGeneWeightValues_DF,generate_topNGeneWeightStats_DF,create_vec_cluster_gene_weightsbygene_mat,topGenesClustersbygene_byCalledCluster,topGenesClustersbygene_byAllCells,gene_weights_clus_tensor,gene_weights_not_clus_tensor,generate_topNGeneWeightStats_DF_tensor,calc_cell_normal_μ_τ_ll_scores,calc_cell_normal_μ_τ_l_scores,calc_cell_normal_μ_τ_ll_gene_weights,calc_cell_normal_μ_τ_ll_gene_weightsbygene,calculate_gene_weight_mean,calculate_gene_weight_variance,calculate_gene_weight_stdev,calculate_gene_weight_n,calc_gene_importance_weights,get_gene_PIP,get_bayes_factor,calculate_gene_weight_posteriorInterval,calculate_gene_weight_summary_statistics



include(curr_dir*src_dir*"TidyUtils.jl")
using .TidyUtils

export recursive_flatten, outermelt,  innermelt, tidify_data, tidify_labels, tidify_mixture_weights, tidify_state_params, tidify_state_hyperprior_params,tidify_θ, tidify_τ_μ_expected_value, tidify_log_τ_kj_expected_value, tidify_log_π_expected_value, tidify_cttprime, tidify_rtik, tidify_clustering_params, tidify_time_params, tidify_scalar_hyperprior_params, tidify_ηtkj, tidify_error_state_params, tidy_get_Nt_from_xmat, tidy_get_Nt_from_rtikmat, tidy_get_next_chain_rows_indices, tidy_make_chain, tidy_truncate_chain, tidy_get_timeranges, IndexCounter, increment!, getCount



include(curr_dir*src_dir*"test_viFunctions.jl")



include(curr_dir*src_dir*"baselines_RCall.jl")

export R_baseline_SOUP ,all_unique ,df_add_first_column ,df_transpose


include(curr_dir*src_dir*"viDevelopment_ModelVersions.jl")

export variational_inference_dynamicHDP_dev, variational_inference_dynamicHDP_vs7, variational_inference_dynamicHDP_vs7_2, variational_inference_dynamicHDP_vs12, variational_inference_dynamicHDP_vs12_2, variational_inference_dynamicHDP_vs14, variational_inference_dynamicHDP_vs15, variational_inference_dynamicHDP_vs16, variational_inference_dynamicHDP_vs17, variational_inference_dynamicHDP_vs18, variational_inference_dynamicHDP_vs19, variational_inference_dynamicHDP_vs20, variational_inference_dynamicHDP_vs21, variational_inference_dynamicHDP_vs22, variational_inference_dynamicHDP_vs23, variational_inference_dynamicHDP_vs24, variational_inference_dynamicHDP_vs25, variational_inference_dynamicHDP_vs25_fast, variational_inference_dynamicHDP_vs25_fast2



end